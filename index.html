<!doctype html>
<html lang="ko">
  <head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.8.1/css/ol.css">
    <link rel="stylesheet" href="//cdn.rawgit.com/Viglino/ol-ext/master/dist/ol-ext.css" />
    <link rel="stylesheet" href="resources/css/map.css"/>

    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.8.1/build/ol.js"></script>
    <script type="text/javascript" src="//cdn.rawgit.com/Viglino/ol-ext/master/dist/ol-ext.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/1.3.1/proj4.js"></script>
    <script src="resources/js/proj4-src.js"></script>
    <script src="resources/js/map.js"></script>
    
    <title>Portfolio</title>
  </head>
  <body>
    <div id="fullscreen" class="fullscreen">
      <div id="map" class="map"></div>
      <div id="menu">
        <div class="border-radius-lg d-flex me-2 opacity-6 text-dark me-1">
          <input type="text" class="form-control border-1 ps-1" placeholder="주소 검색" id="srch_address" name="srch_address"
            aria-haspopup="true" aria-expanded="false" autocomplete="off" value="서초대로 49길 11">
          <button class="btn btn-yoonsik btn-sm mb-0 me-1" name="SearchBtn"
            onclick="srch_addr($('input[name=srch_address]').val())">Search</button>
        </div>
        <div id="vLayerList" class="">
          <div class="">
            <div>
              <select id="select_wms" class="card form-select form-select-sm " size="15">
                <optgroup label="국토관리/지역개발">
                </optgroup>
                <optgroup label="경계">
                  <option value="LT_C_ADSIDO">광역시도</option>
                  <option value="LT_C_ADRI">리</option>
                  <option value="LT_C_ADSIGG">시군구</option>
                  <option value="LT_C_ADEMD">읍면동</option>
                  <option value="LT_P_NSNMSSITENM">국가지명</option>
                </optgroup>
                <optgroup label="일반공공행정">
                </optgroup>
                <optgroup label="일반행정">
                  <option value="LT_C_SPBD">도로명주소건물</option>
                  <option value="LT_L_SPRD">도로명주소도로</option>
                </optgroup>
                <optgroup label="산업/중소기업">
                </optgroup>
                <optgroup label="산업">
                  <option value="lt_c_dgmainbiz">주요상권</option>
                  <option value="lt_p_busiincubator">창업보육센터</option>
                </optgroup>
                <optgroup label="산업단지">
                  <option value="LT_C_DAMDAN">단지경계</option>
                  <option value="LT_C_DAMYOJ">단지시설용지</option>
                  <option value="LT_C_DAMYOD">단지용도지역</option>
                  <option value="LT_C_DAMYUCH">단지유치업종</option>
                  <option value="LT_P_WEISPLAFACA">농공단지처리시설</option>
                </optgroup>
                <optgroup label="도시계획">
                  <option value="LT_C_UPISUQ171">개발행위허가제한지역</option>
                  <option value="LT_C_UPISUQ174">개발행위허가필지</option>
                  <option value="LT_C_UPISUQ173">기반시설부담구역</option>
                  <option value="LT_C_UPISUQ153">도시계획(공간시설)</option>
                  <option value="LT_C_UPISUQ155">도시계획(공공문화체육시설)</option>
                  <option value="LT_C_UPISUQ152">도시계획(교통시설)</option>
                  <option value="LT_C_UPISUQ159">도시계획(기타기반시설)</option>
                  <option value="LT_C_UPISUQ151">도시계획(도로)</option>
                  <option value="LT_C_UPISUQ156">도시계획(방재시설)</option>
                  <option value="LT_C_UPISUQ157">도시계획(보건위생시설)</option>
                  <option value="LT_C_UPISUQ154">도시계획(유통공급시설)</option>
                  <option value="LT_C_UPISUQ158">도시계획(환경기초시설)</option>
                  <option value="LT_C_UPISUQ161">지구단위계획</option>
                  <option value="LT_C_UPISUQ175">토지거래계약에관한허가구역</option>
                  <option value="LT_C_LHBLPN">토지이용계획도</option>
                </optgroup>
                <optgroup label="용도지역지구">
                  <option value="LT_C_UD801">개발제한구역</option>
                  <option value="LT_C_UQ129">개발진흥지구</option>
                  <option value="LT_C_UQ121">경관지구</option>
                  <option value="LT_C_UQ123">고도지구</option>
                  <option value="LT_C_UQ112">관리지역</option>
                  <option value="LT_C_UMA100">국립공원용도지구</option>
                  <option value="LT_C_UQ141">국토계획구역</option>
                  <option value="LT_C_UQ113">농림지역</option>
                  <option value="LT_C_UQ162">도시자연공원구역</option>
                  <option value="LT_C_UQ111">도시지역</option>
                  <option value="LT_C_UQ125">방재지구</option>
                  <option value="LT_C_UQ124">방화지구</option>
                  <option value="LT_C_UQ126">보존지구</option>
                  <option value="LT_C_UQ127">시설보호지구</option>
                  <option value="LT_C_UF602">임업 및 산촌 진흥권역</option>
                  <option value="LT_C_UQ114">자연환경보전지역</option>
                  <option value="LT_C_UQ128">취락지구</option>
                  <option value="LT_C_UQ130">특정용도제한지구</option>
                </optgroup>
                <optgroup label="용도지역지구(기타)">
                  <option value="LT_C_UM000">가축사육제한구역</option>
                  <option value="LT_C_UP201">재해위험지구</option>
                  <option value="LT_C_UPISUQ161">지구단위계획</option>
                  <option value="LT_C_UQ122">미관지구</option>
                  <option value="LT_C_TDWAREA">보행우선구역</option>
                  <option value="LT_C_USFSFFB">소방서관할구역</option>
                  <option value="LT_C_UO601">관광지</option>
                  <option value="LT_C_UD610">국민임대주택</option>
                  <option value="LT_C_UP401">급경사재해예방지역</option>
                  <option value="LT_C_UM301">대기환경규제지역</option>
                  <option value="LT_C_UF901">백두대간보호지역</option>
                  <option value="LT_C_UH701">벤처기업육성지역</option>
                  <option value="LT_C_UD620">보금자리주택</option>
                  <option value="LT_C_UF151">산림보호구역</option>
                  <option value="LT_C_UM901">습지보호지역</option>
                  <option value="LT_C_UB901">시장정비구역</option>
                  <option value="LT_C_UM221">야생동식물보호</option>
                  <option value="LT_C_UJ401">온천지구</option>
                  <option value="LT_C_UH501">유통단지</option>
                  <option value="LT_C_UH402">자유무역지역지정및운영</option>
                  <option value="LT_C_UD601">주거환경개선지구도</option>
                  <option value="LT_C_UO101">학교환경위생정화구역</option>
                </optgroup>
                <optgroup label="토지">
                  <option value="LT_C_LHZONE">사업지구경계도</option>
                  <option value="LT_C_GIMSSCS">토양도</option>
                  <option value="LP_PA_CBND_BUBUN,LP_PA_CBND_BONBUN">지적도</option>
                  <option value="LT_C_KFDRSSIGUGRADE">산불위험예측지도</option>
                  <option value="LT_C_ASITDEEPSOIL">심토토성</option>
                  <option value="LT_C_ASITSOILDEP">유효토심</option>
                  <option value="LT_C_ASITSURSTON">자갈함량</option>
                  <option value="LT_P_EDRSE002">지진대피소</option>
                  <option value="LT_P_ETQSHELTER">지진해일대피소</option>
                  <option value="LT_C_GIMSLINEA">지질구조밀도</option>
                  <option value="LT_L_GIMSLINEA">지질구조선</option>
                  <option value="LT_L_GIMSFAULT">단층</option>
                </optgroup>
                <optgroup label="폐기물/폐수">
                  <option value="LT_C_ASITSOILDRA">배수등급</option>
                  <option value="LT_P_WEISPLAFACS">축산폐수공공처리시설</option>
                  <option value="LT_P_WEISPLAFACW">하수종말처리시설</option>
                  <option value="LT_P_SGISGWCHG">지하수측정망(오염우려지역)</option>
                  <option value="LT_P_WEISPLAFACL">매립장침출수처리시설</option>
                  <option value="LT_P_WEISPLAFACE">기타공동처리시설</option>
                </optgroup>
                <!-- 국토관리/지역개발 -->
                <optgroup label="농림/해양/수산">
                </optgroup>
                <optgroup label="농업/농촌">
                  <option value="LT_C_AGRIXUE101">농업진흥지역도</option>
                  <option value="LT_P_RIFCT">수리시설</option>
                  <option value="LT_C_AGRIXUE102">영농여건불리농지도</option>
                  <option value="LT_C_RIRSV">저수지</option>
                </optgroup>
                <optgroup label="임업/산촌">
                  <option value="LT_C_FSDIFRSTS">산림입지도</option>
                  <option value="LT_C_FLISFK300">산지(보안림)</option>
                  <option value="LT_C_FLISFK100">산지(자연휴양림)</option>
                  <option value="LT_C_FLISFK200">산지(채종림)</option>
                </optgroup>
                <optgroup label="해양/수산/어촌">
                  <option value="LT_C_UM710">상수원보호</option>
                  <option value="LT_C_WGISPLTALK">개발유도연안</option>
                  <option value="LT_C_WGISPLROW">개발조정연안</option>
                  <option value="LT_C_WGISPLUSE">이용연안</option>
                  <option value="LT_C_WGISPLABS">절대보전연안</option>
                  <option value="LT_C_WGISPLJUN">준보전연안</option>
                  <option value="LT_C_TFISTIDAF,LT_P_TFISTIDAFP">갯벌정보</option>
                  <option value="LT_C_WGISRERESH">공유수면매립3차수요조사</option>
                  <option value="LT_C_WGISREPLAN">공유수면매립기본계획</option>
                  <option value="LT_C_WGISRECOMP">공유수면매립준공</option>
                  <option value="LT_C_WGISIEGUG">국가산업단지</option>
                  <option value="LT_C_WGISIENONG">농공단지</option>
                  <option value="LT_C_WGISTPNEWP">무역신항만</option>
                  <option value="LT_C_WGISTPLAND">무역항육상구역</option>
                  <option value="LT_C_WGISTPSEA">무역항해상구역</option>
                  <option value="LT_C_WGISARECO">생태계경관보전지역</option>
                  <option value="LT_C_WGISARFISHER">수산자원보호구역</option>
                  <option value="LT_C_WGISARWET">습지보호구역</option>
                  <option value="LT_C_WGISCPLAND">연안항육상구역</option>
                  <option value="LT_C_WGISCPSEA">연안항해상구역</option>
                  <option value="LT_C_WGISIEILBAN">일반산업단지</option>
                  <option value="LT_C_WGISIEDOSI">첨단산업단지</option>
                  <option value="LT_L_TOISDEPCNTAH">해안선</option>
                  <option value="LT_C_TFISMPA">해양보호구역</option>
                  <option value="LT_C_WGISFMGUL">굴양식장</option>
                  <option value="LT_C_WGISFMKIM">김양식장</option>
                  <option value="LT_C_WGISFMDSM">다시마양식장</option>
                  <option value="LT_C_WGISFMMYK">미역양식장</option>
                  <option value="LT_C_WGISFMFISH">어류양식장</option>
                  <option value="LT_C_WGISFMJBOK">전복양식장</option>
                  <option value="LT_C_CDFRS100FRQ">해안침수(100년빈도)</option>
                  <option value="LT_C_CDFRS150FRQ">해안침수(150년빈도)</option>
                  <option value="LT_C_CDFRS200FRQ">해안침수(200년빈도)</option>
                  <option value="LT_C_CDFRS050FRQ">해안침수(50년빈도)</option>
                  <option value="LT_C_CDFRSMAXFRQ">해안침수(최대범람)</option>
                </optgroup>
                <!-- 해양/수산/어촌 -->
                <optgroup label="수질">
                </optgroup>
                <optgroup label="수자원">
                  <option value="LT_C_WKMBBSN">대권역</option>
                  <option value="LT_C_WKMMBSN">중권역</option>
                  <option value="LT_C_WKMSBSN">표준권역</option>
                  <option value="LT_C_WKMSTRM">하천망</option>
                  <option value="LT_P_WEISPLAFACV">마을하수도</option>
                </optgroup>
                <option value="LT_P_WEISTACCON">수생태계조사지점</option>
                <option value="LT_P_WEISSITETB">수질자동측정망측정지점</option>
                <option value="LT_P_WEISSITEME">수질측정망공단배수지점</option>
                <option value="LT_P_WEISSITEMD">수질측정망농업용수지점</option>
                <option value="LT_P_WEISSITEMF">수질측정망도시관류지점</option>
                <option value="LT_P_WEISSITEMA">수질측정망하천수지점</option>
                <option value="LT_P_WEISSITEMB">수질측정망호소수지점</option>
                <option value="LT_C_GIMSSTIFF">수질다이어그램</option>
                <option value="LT_L_GIMSDEPTH">지하수등수심선</option>
                <option value="LT_L_GIMSPOTEN">지하수등수위선</option>
                <option value="LT_L_GIMSDIREC">지하수유동방향</option>
                <optgroup label="교통/도로/물류">
                </optgroup>
                <optgroup label="교통">
                  <option value="LT_P_UTISCCTV">교통CCTV</option>
                  <option value="LT_P_MOCTNODE">교통노드</option>
                  <option value="LT_L_MOCTLINK">교통링크</option>
                </optgroup>
                <optgroup label="항공/공항">
                  <option value="LT_C_AISALTC">경계구역</option>
                  <option value="LT_C_AISRFLC">공중급유구역</option>
                  <option value="LT_C_AISACMC">공중전투기동훈련장</option>
                  <option value="LT_C_AISCTRC">관제권</option>
                  <option value="LT_C_AISMOAC">군작전구역</option>
                  <option value="LT_C_AISADZC">방공식별구역</option>
                  <option value="LT_C_AISPRHC">비행금지구역</option>
                  <option value="LT_C_AISATZC">비행장교통구역</option>
                  <option value="LT_C_AISFIRC">비행정보구역</option>
                  <option value="LT_C_AISRESC">비행제한구역</option>
                  <option value="LT_L_AISSEARCHL,LT_P_AISSEARCHP">수색비행장비행구역</option>
                  <option value="LT_L_AISVFRPATH,LT_P_AISVFRPATH">시계비행로</option>
                  <option value="LT_C_AISDNGC">위험구역</option>
                  <option value="LT_C_AISTMAC">접근관제구역</option>
                  <option value="LT_L_AISROUTEU">제한고도</option>
                  <option value="LT_L_AISCORRID_YS,LT_L_AISCORRID_GJ,LT_P_AISCORRID_YS,LT_P_AISCORRID_GJ">한강회랑</option>
                  <option value="LT_L_AISPATH">항공로</option>
                  <option value="LT_P_AISHCSTRIP">헬기장</option>
                  <option value="LT_C_AISCATC">훈련구역</option>
                </optgroup>
                <optgroup label="문화/체육/관광">
                </optgroup>
                <optgroup label="관광">
                </optgroup>
                <optgroup label="문화예술">
                </optgroup>
                <optgroup label="문화재">
                  <option value="LT_C_UO301">문화재보호도</option>
                  <option value="LT_C_UO501">전통사찰보존</option>
                </optgroup>
                <optgroup label="체육">
                  <option value="LT_C_WGISNPGUG">국립자연공원</option>
                  <option value="LT_C_WGISNPGUN">군립자연공원</option>
                  <option value="LT_C_WGISNPDO">도립자연공원</option>
                  <option value="LT_L_FRSTCLIMB,LT_P_CLIMBALL">등산로</option>
                  <option value="LT_L_TRKROAD,LT_P_TRKROAD">산책로</option>
                  <option value="LT_L_BYCLINK">자전거길</option>
                  <option value="LT_P_BYCRACKS">자전거보관소</option>
                  <option value="LT_P_SGISGOLF">골프장현황도</option>
                </optgroup>
                <optgroup label="사회복지">
                </optgroup>
                <optgroup label="사회복지">
                  <option value="LT_P_MGPRTFD">기타보호시설</option>
                  <option value="LT_P_MGPRTFB">노인복지시설</option>
                  <option value="LT_P_MGPRTFC">아동복지시설</option>
                  <option value="LT_P_MGPRTFA">아동안전지킴이집</option>
                </optgroup>
                <option value="LT_C_GIMSHYDRO">수문지질단위</option>
                <option value="LT_L_GIMSEC">전기전도도</option>
                <option value="LT_P_MOGEFFACT">여가부시설</option>
              </select>
            </div>
          </div>
        </div>
    </div>

    <div style="display: none;">
      <label>
        <input type="checkbox" style="display: none;" id="rotateWithView">
      </label>
      <form id="wfsForm">
        <input type="hidden" name="key" value="C4C4FE9D-271A-3D7D-9DBE-BF7030912E04">
        <input type="hidden" name="SERVICE" value="WFS">
        <input type="hidden" name="version" value="1.1.0">
        <input type="hidden" name="request" value="GetFeature">
        <input type="hidden" name="TYPENAME" value="">
        <input type="hidden" name="OUTPUT" value="text/javascript">
        <input type="hidden" name="SRSNAME" value="EPSG:3857">
        <input type="hidden" name="BBOX" value="">
      </form>
      <input type="hidden" name="SGIS_AccessToken" value="">
      <input type="hidden" name="road_address" value="">
      <input type="hidden" name="bunji_address" value="">
      <input type="hidden" name="sido_nm" value="">
    </div>
    <script type="text/javascript">

     /**
 * 줌아웃 인 이벤트
 * 기능 : 해당주소를 5179좌표로 변환하여 알려준다.
 * 참고사항 : SGIS api 활용 단 주소가 옛날 체계를 사용함(법정동도 껴있음)
 *  duration 수치와 애니메이션수치 조절시 줌확대,이동속도 조절가능
 */
function flyTo(location, done) {
    var duration = 5000;
    //var zoom = map.getView().getZoom();
    var zoom = 9;
    var parts = 2;
    var called = false;
    function callback(complete) {
      --parts;
      if (called) {
        //console.log("1");
        return;
      }
      if (parts === 0 || !complete) {
        //console.log("2");
        //console.log(complete);
        called = true;
        
        done(complete);
      }
    }
    olView.animate(
      {
        center: location,
        duration: duration,
      },
      callback
    );
    olView.animate(
      {
        zoom: zoom - 1,
        duration: duration / 2,
      },
      {
        zoom: 19,
        duration: duration / 2,
      },
      callback
    );
  }


  /**
 * SGIS 지오코딩
 * 기능 : 해당주소를 5179좌표로 변환하여 알려준다.
 * 참고사항 : SGIS api 활용 단 주소가 옛날 체계를 사용함(법정동도 껴있음)
 */

  function srch_addr(address){
	//주소
  console.log(address);
	var param = {
		"address":address,
		"accessToken" :	$("input[name=SGIS_AccessToken]").val(),
        "pagenum" : 0, //페이지수 default : 0
        "resultcount" : 1 // 결과수 최소 1 최대 50  기본값 5
	}
    $.ajax({
		type: "GET", 
		url : "https://sgisapi.kostat.go.kr/OpenAPI3/addr/geocode.json",
		data : param,
		dataType:'json',
		success : function(data){
            var coordinate_x = data.result.resultdata[0].x;
            var coordinate_y = data.result.resultdata[0].y;
            var point = new ol.geom.Point([Number(coordinate_x),Number(coordinate_y)]);
            var p_3857 = proj4('EPSG:5179','EPSG:3857',[point.flatCoordinates[0],point.flatCoordinates[1]]);
            console.log(p_3857);
            flyTo(p_3857, function () {});

		}
    }); 
    
}

 /**
 * SGIS 리버스 지오코딩
 * 기능 : 해당좌표를 도로명,지번으로 조회한다
 * 참고사항 : SGIS api 활용 단 주소가 옛날 체계를 사용함(법정동도 껴있음)
 */
  function Reverse_GeoCodding(loc_x, loc_y, addr_type){
	console.log(loc_x);
	console.log(loc_y);
	
	//도로명주소
	var param = {
		"x_coor":loc_x,
		"y_coor":loc_y,
		"addr_type":"10",
		"accessToken" :	$("input[name=SGIS_AccessToken]").val()
	}
	var param2 = {
		"x_coor":loc_x,
		"y_coor":loc_y,
		"addr_type":"21",
		"accessToken" :	$("input[name=SGIS_AccessToken]").val()
	}


	geocode_promise_function(param2)
	.then(geocode_promise_function(param))
    .finally();
	//.then(notification.show([$("input[name=road_address]").val() +"  "+ $("input[name=bunji_address]").val()]));

}

  function geocode_promise_function(param) {
    return new Promise((resolve, reject) => {
      $.ajax({
        type: "GET",
        //url : "/location/Reverse_GeoCodding",
        url: "https://sgisapi.kostat.go.kr/OpenAPI3/addr/rgeocode.json",
        data: param,
        dataType: 'json',
        success: function (data) {
          console.log(data);
          if (data.errMsg == 'Success') {
            if (data.result[0].hasOwnProperty('emdong_nm')) {
              $("input[name=bunji_address]").val(data.result[0].full_addr);
              notification.show([$("input[name=bunji_address]").val() + '<br>' + $("input[name=road_address]").val()]);

            } else {
              $("input[name=road_address]").val(data.result[0].full_addr);
              notification.show([$("input[name=bunji_address]").val() + '<br>' + $("input[name=road_address]").val()]);

            }
            if (data.result[0].hasOwnProperty('sido_nm')) {
              $("input[name=sido_nm]").val(data.result[0].sido_nm);
            }
          } else {
            $("input[name=road_address]").val(data.errMsg);
            notification.show([$("input[name=bunji_address]").val() + '<br>' + $("input[name=road_address]").val()]);
          }

        }
      });
    });
  }

 /**
 * SGIS 인증키발급
 * 기능 : SGIS 인증키를 매번 실행시 받는다.
 * 참고사항 : 매번 실행시 인증키가 변경됌
 */
 function sgis_authkey(){
	var cunsumer_key = "c8fa0b47181b4c48897f";
	var consumer_secret = "5172bd52d4d7465ba144";
	var param = {
		"consumer_key" : cunsumer_key,
		"consumer_secret" : consumer_secret,
	}
	
	
	$.ajax({
		type: "GET", 
		//url : "/location/Reverse_GeoCodding",
		url : "https://sgisapi.kostat.go.kr/OpenAPI3/auth/authentication.json",
		data : param,
		dataType:'json',
		success : function(getResult){
			console.log(getResult);
			$("input[name=SGIS_AccessToken]").val(getResult.result.accessToken);
			

		},		
	});	
	
}

 /**
 * SGIS 인구주택총조사
 * 기능 : SGIS 인증키를 매번 실행시 받는다.
 * 참고사항 : 
 * adm_cd : 선택사항
 * 	non : 전국 시도 리스트
 * 2자리 : 해당 시도
 * 5자리 : 해당 시군구
 * 7자리 : 해당 읍면동
 * 
 * low_seach : 선택사항
 * 행정구역코드에 해당하는 정보만 요청 : 0
 * 1단계 하위 행정구역 정보 요청 : 1
 * 2단계 하위 행정구역 정보 요청 : 2
 */

function sgis_populations(sigunguCode){
    var param = {
        accessToken : 	$("input[name=SGIS_AccessToken]").val(),
        year : 2019,
        adm_cd : '',
        low_search : '1',  //default : 1
    }

    $.ajax({
		type: "GET", 
		//url : "/location/Reverse_GeoCodding",
		url : "https://sgisapi.kostat.go.kr/OpenAPI3/stats/population.json",
		data : param,
		dataType:'json',
		success : function(getResult){
			console.log(getResult);
			alert(getResult);
			

		},		
	});	
}

 /**
 * 용도별건물정보서비스 
 * URL : http://openapi.nsdi.go.kr/nsdi/eios/OpenapiList.do?provOrg=SCOS&gubun=S
 * 참고사항 : 국가공간정보포털에서 제공하는 자료는 하루 1만건이 최대
 * 그렇기때문에 공공데이터 포털에서 신청시 하루 100만건까지 되오나 현재 안되는상황
 * 결국 국가공간정보포털에서 받아가는 자료인데 국가정보포털꺼는 되오나 공공데이터포털꺼는 안된다.
 */
 function openapiTest(PolygonName,setName){ //용도별건물정보서비스
	var params = { //이건 국가공간정보포털
		'backcolor':'0xRRGGBB',
		'SERVICE':'WMS',
		'REQUEST':'GetMap',
		'FORMAT':'image/png',
		'TRANSPARENT':'true',
		'STYLES':'',
		'VERSION':'1.3.0',
		'LAYERS':'F253',
		'WIDTH':'915',//512,256
		'HEIGHT':'700',//512,256
		'CRS':'EPSG:3857',
		'authkey':'e81986658904d15b1ac83f',
		//'ServiceKey':'C1wdeeOwmZvH+X0rpTyH7R9MhQWiSyw4hfGlGkY35pHKMrBY8rgKRvTyJlq48/U8Gz9+7AoqL/1yMbiEembLMg==',
		'exceptions':'blank'
	}
	var vector = new ol.layer.Tile({	
					  source: new ol.source.TileWMS({
					    url: 'http://openapi.nsdi.go.kr/nsdi/BuildingUseService/wms/getBuildingUseWMS',    //이건 국가공간정보포털
						//url: 'http://apis.data.go.kr/1611000/nsdi/BuildingUseService/wms/getBuildingUseWMS', //공공데이터포털
						params:params,
						/*
						params:	{
							'ServiceKey':'C1wdeeOwmZvH+X0rpTyH7R9MhQWiSyw4hfGlGkY35pHKMrBY8rgKRvTyJlq48/U8Gz9+7AoqL/1yMbiEembLMg==',
							 'LAYERS':'F253',
							 'CRS':'EPSG:5174',
							 'WIDTH':'256',//512,256
							 'HEIGHT':'256',//512,256
							 'FORMAT':'image/png',
							 'TRANSPARENT':'true',
							 'bgcolor':'0xFFFFFF',
							 'exceptions':'blank'
						},
						*/   
						serverType:'geoserver',
					  }),
				    	minResolution: 0,
    					maxResolution: 11,
						visible: false,
					});
	vector.set("name",setName);
	map.addLayer(vector);
}

/**
 * v월드 레이어 선택부분
 * URL : 
 * 참고사항 : select_wms 선택값 변경시 해당레이어 추가한다.
 * 
 * 
 */

 $(function(){
	$(document).on('change','#select_wms',function(){
		let this_val = $(this).val();
		//console.log($(this).find("option[value='" + $(this).val() + "']").text()); 선택된 옵션의 text
		let this_layer = $(this).find("option[value='" + $(this).val() + "']").text();
		let this_title = $(this).prev().text();
		$('[name=TYPENAME]').val(this_val.toLowerCase());
		//선택시 레이어 삭제
		map.getLayers().forEach(function(layer){
			 if(layer.get("name")==this_layer){
			 	map.removeLayer(layer);//기존결과 삭제
			 }
		})
		let code = map.getView().getProjection().getCode();
		
		let layer_tile = new ol.layer.Tile({
	        //title:  'v월드',//this_title,
	        id: this_val,
	        //name: 'wms_theme', //vmap 올린 레이어를 삭제하거나 수정,변경할때 접근할 name 속성
	        projection: code,
	        extent: map.getView().getProjection().getExtent(), //[-20037508.34, -20037508.34, 20037508.34, 20037508.34]
	        //maxZoom: 21,
	        //minZoom: 10,
	        tilePixelRatio: 1,
	        tileSize: [512, 512],

	        source: new ol.source.TileWMS({
		    url: "https://api.vworld.kr/req/wms?",
	            params: {
	                LAYERS: this_val.toLowerCase(),
	                STYLES: this_val.toLowerCase(),
	                CRS: code,
	                apikey: "D8DA2C77-00ED-3DE3-8252-E183BB2F1B6A",
	                FORMAT: "image/png",
	                WIDTH:512,
	                HEIGHT:512
	            },
		    }),
            opacity:0.3,
		});
    
		layer_tile.setZIndex(5);
		layer_tile.set("name",this_layer);
        	layer_tile.set("id",this_layer);
		map.addLayer(layer_tile);
		let imgSrc = "https://api.vworld.kr/req/image?key=C4C4FE9D-271A-3D7D-9DBE-BF7030912E04&service=image&request=GetLegendGraphic&format=png&type=ALL&layer="+this_val+"&style="+this_val
        	$('#wms_image').append("<img src='"+imgSrc+"' alt ='"+this_title+"' >");
		
	});//'change'
})
//vworld wfs
function vworld_wfs(evt){
    map.getLayers().forEach(function(layer){
        // if(layer.get("name")=="시군구"){}
        let selectlayer = layer.get("id")
        // if(selectlayer.indexOf(",") >-1){
        //     selectlayer = selectlayer.split(",")[0]; 
        // }
        //data API는 레이어 1개씩 조회가 가능해서 2개이상이 입력될경우 변경되도록 설정(지적도)
        let min = map.getCoordinateFromPixel([evt.pixel[0] -4,evt.pixel[1]+4])
        let max = map.getCoordinateFromPixel([evt.pixel[0] +4,evt.pixel[1]-4])
        let box = min[0]+","+min[1]+","+max[0]+","+max[1]
        let code = map.getView().getProjection().getCode();
        /*WFS jsonp 테스트*/
        $('#wfsForm > [name=BBOX]').val(box);		
        $('#wfsForm > [name=SRSNAME]').val(code);
        $.ajax({
            type: "get",
            url: "https://api.vworld.kr/req/wfs",
            data : $('#wfsForm').serialize(),
            dataType: 'jsonp',
            async: false,
            jsonpCallback:"parseResponse",
            success: function(data) {
                let vectorSource = new ol.source.Vector({features: (new ol.format.GeoJSON()).readFeatures(data)})
                map.getLayers().forEach(function(ollayer){
                    if(ollayer.get("name")=="wfs_result"){
                        map.removeLayer(ollayer);//기존결과 삭제
                    }
                })
                let vector_layer = new ol.layer.Vector({
                    source: vectorSource,
                    //style: vectorStyle
                })
                
                vector_layer.set("name","wfs_result");
                map.addLayer(vector_layer);
                
                let resultFeature = vectorSource.getFeatures()[0]
                if(typeof resultFeature == "object"){
                    let wfs_html="";
                    for(let i in resultFeature.getKeys()){ 
                    if(resultFeature.getKeys()[i] == "bbox"){
                        continue;
                    }
                        wfs_html += resultFeature.getKeys()[i] + " = "+resultFeature.get(resultFeature.getKeys()[i])+"\n<br>";
                    }
                        wfs_html += "--------------------------------------<br>";
                        $('#wfs_result').html(wfs_html);
                }
            },
            error: function(xhr, stat, err) {}
        });
    });
}

/**
 * 주소검색 클릭시 상세주소입력창 다음주소api활용
 * 기능 : 주소검색시 시군구코드 가 담겨있다.
 * 참고사항 : 레이어를 추가할경우 항상 이름을 붙여줄것 
 */
 $("#srch_address").on("click", function(){
     //아래 코드처럼 테마 객체를 생성합니다.(color값은 #F00, #FF0000 형식으로 입력하세요.)
    //변경되지 않는 색상의 경우 주석 또는 제거하시거나 값을 공백으로 하시면 됩니다.
    var themeObj = {
        //bgColor: "", //바탕 배경색
        //searchBgColor: "", //검색창 배경색
        //contentBgColor: "", //본문 배경색(검색결과,결과없음,첫화면,검색서제스트)
        //pageBgColor: "", //페이지 배경색
        //textColor: "", //기본 글자색
        //queryTextColor: "", //검색창 글자색
        //postcodeTextColor: "", //우편번호 글자색
        //emphTextColor: "", //강조 글자색
        //outlineColor: "" //테두리
    };
    new daum.Postcode({
        theme:themeObj,
        onsearch:function(data){
            //q : 검색어
            //count : 결과총갯수
            console.log(data);
        },
        width:500,
        height:500,
        animation:true,
        focusInput:true,
        autoMapping:false,  //주소와 도로명주소가 무조건 메칭되게 설정
        shrothand:false,//서울특별시 -> 서울, 광주광역시 -> 광주 기능 세종,제주 제외
        oncomplete: function(data) {
            // 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분입니다.
            // 예제를 참고하여 다양한 활용법을 확인해 보세요.
            $("#srch_address").val(data.address);
            srch_addr($('input[name=srch_address]').val());
            // postcode: ""
            // postcode1: ""
            // postcode2: ""
            // postcodeSeq: ""
            // zonecode: "06596"
            // address: "서울 서초구 서초대로49길 11"
            // addressEnglish: "11, Seocho-daero 49-gil, Seocho-gu, Seoul, Korea"
            // addressType: "R"
            // bcode: "1165010800"
            // bname: "서초동"
            // bnameEnglish: "Seocho-dong"
            // bname1: ""
            // bname1English: ""
            // bname2: "서초동"
            // bname2English: "Seocho-dong"
            // sido: "서울"
            // sidoEnglish: "Seoul"
            // sigungu: "서초구"
            // sigunguEnglish: "Seocho-gu"
            // sigunguCode: "11650"
            // userLanguageType: "K"
            // query: "서초대로49길"
            // buildingName: "명산빌딩"
            // buildingCode: "1165010800117120004020354"
            // apartment: "N"
            // jibunAddress: "서울 서초구 서초동 1712-4"
            // jibunAddressEnglish: "1712-4, Seocho-dong, Seocho-gu, Seoul, Korea"
            // roadAddress: "서울 서초구 서초대로49길 11"
            // roadAddressEnglish: "11, Seocho-daero 49-gil, Seocho-gu, Seoul, Korea"
            // autoRoadAddress: ""
            // autoRoadAddressEnglish: ""
            // autoJibunAddress: ""
            // autoJibunAddressEnglish: ""
            // userSelectedType: "R"
            // noSelected: "N"
            // hname: ""
            // roadnameCode: "4163412"
            // roadname: "서초대로49길"
            // roadnameEnglish: "Seocho-daero 49-gil"
        }
    }).open({
        popupTitle:'우편번호 검색',
        popupKey:'addressPopup',
        autoClose:true
    });
 });

/**
 * 레이어 삭제함수
 * 기능 : String 에 일치하는 레이어를 삭제
 * 참고사항 : 레이어를 추가할경우 항상 이름을 붙여줄것 
 */
function layerRemover(getName){
	map.getLayers().forEach(function(ollayer){
		if(ollayer.get("name")==getName){
			map.removeLayer(ollayer);//기존결과 삭제
		}
	})
}


$(document).ready(function(){
  sgis_authkey();

});
    </script>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  </body>
</html>
